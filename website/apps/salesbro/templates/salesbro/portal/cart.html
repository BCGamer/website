{% extends "salesbro/portal/base.html" %}
{% load mezzanine_tags shop_tags i18n %}

{% block body_id %}sales_portal_cart{% endblock %}

{% block main %}
    <div class="container">
        <div class="row">

            <div class="col-md-9 middle">
                {% if cart_formset.forms %}
                    <div class="row">
                        <div class="col-md-12">
                            Review the cart with the customer and take payment before continuing.
                        </div>
                    </div>

                    <div class="spacer-10"></div>
                    <form method="post" class="cart-form">
                        {% csrf_token %}
                        <hr><div class="spacer-10"></div>

                        <!--
                        {{ customer_form.management_form }}
                        {% for field in customer_form %}
                            <div class="row">

                                <div class="col-md-6 form-group {% if field.quantity.errors %}has-error{% endif %}">
                                    {{ field.label }}{{ field }}
                                </div>
                            </div>

                        {% endfor %}
                        -->
                        <!--TODO: reformat this using bootstrap scaffolding to make it look less like poop-->
                        {{ cart_formset.management_form }}
                        <div class="row">
                            <div class="col-md-5"><h3>Item(s)</h3></div>
                            <div class="col-md-2"><h3>Unit Price</h3></div>
                            <div class="col-md-1"><h3>Qty</h3></div>
                            <div class="col-md-2 right"><h3>Price</h3></div>
                            <div class="col-md-2 center"><h3>Remove?</h3></div>
                        </div>

                        {% for form in cart_formset.forms %}
                            {% with form.instance as item %}
                                <div class="row">
                                    {{ form.id }}
                                    <div class="col-md-5">{{ item.description }}</div>
                                    <div class="col-md-2">{{ item.unit_price|currency }}</div>
                                    <div class="col-md-1 quantity">{{ form.quantity }}</div>
                                    <div class="col-md-2 right">{{ item.total_price|currency }}</div>
                                    <div class="col-md-2 center">{{ form.DELETE }}</div>
                                </div>
                            {% endwith %}
                        {% endfor %}

                        <div class="row">
                            <div class="col-md-5">&nbsp;</div>
                            <div class="col-md-2">&nbsp;</div>
                            <div class="col-md-1">&nbsp;</div>
                            <div class="col-md-2">
                                {% order_totals %}
                            </div>
                            <div class="col-md-2 center">&nbsp;</div>
                        </div>

                        <hr><div class="spacer-30"></div>
                        <div class="row">
                            <div class="col-md-4">
                                <input type="submit" name="back" class="btn btn-primary btn-lg" value="Back">
                            </div>
                            <div class="col-md-4 center">
                                <input type="submit" name="update" class="btn btn-primary btn-lg" value="Update">
                            </div>
                            <div class="col-md-4 right">
                                <input type="submit" name="next" class="btn btn-primary btn-lg" value="Next">
                            </div>
                        </div>
                    </form>


                {% else %}
                    <form method="post" class="cart-form">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-12">
                                Your Cart is empty.
                            </div>
                        </div>
                        <div class="spacer-10"></div>

                        <hr><div class="spacer-30"></div>
                        <div class="row">
                            <div class="col-md-4">
                                <input type="submit" name="back" class="btn btn-primary btn-lg" value="Back">
                            </div>
                        </div>
                    </form>

                {% endif %}
            </div>
        </div>
    </div>
{% endblock main %}
